<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Résultats École - Version Finale</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;margin:0;padding:20px;}
.card{background:#fff;padding:20px;border-radius:10px;max-width:760px;margin:18px auto;box-shadow:0 6px 18px rgba(0,0,0,.06);}
h2{text-align:center;color:#2c3e50;margin-bottom:12px;}
label{display:block;margin-top:12px;font-weight:600;}
input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #d1d5db;font-size:15px;box-sizing:border-box;}
button{background:#2563eb;color:#fff;border:none;cursor:pointer;}
button.secondary{background:#eef2ff;color:#2563eb;}
.photo{width:120px;height:120px;border-radius:8px;object-fit:cover;display:block;margin:10px auto;}
.hidden{display:none;}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:8px;border:1px solid #e6eef8;text-align:left;}
th{background:#f8fafc;}
.muted{color:#6b7280;font-size:13px;margin-top:6px;}
.flex{display:flex;gap:10px;}
.small{width:48%;}
.note{margin:5px 0;}
</style>
</head>
<body>

<div class="card" id="loginCard">
<h2>Connexion parent / élève</h2>
<label for="login">Identifiant</label>
<input id="login" type="text" placeholder="identifiant">
<label for="mdp">Mot de passe</label>
<input id="mdp" type="password" placeholder="mot de passe">
<div class="flex">
<button id="btnConnect">Consulter les résultats</button>
<button id="btnAdmin" class="secondary">Accès Admin</button>
</div>
<div id="resultPanel" class="hidden">
<h2 id="eleveTitre">Résultats</h2>
<img id="elevePhoto" class="photo" src="" alt="photo élève">
<p><strong>Classe :</strong> <span id="eleveClasse"></span></p>
<div id="notesContainer"></div>
<p><strong>Moyenne :</strong> <span id="moyenne"></span> / 20</p>
<div class="flex">
<button id="btnWhats">Recevoir sur WhatsApp</button>
<button id="btnLogout" class="secondary">Se déconnecter</button>
</div>
</div>
</div>

<div class="card hidden" id="adminCard">
<h2>Section Administrateur</h2>

<label>Nom de l'élève</label>
<input id="newNom" type="text" placeholder="Ex: Jean Dupont">

<div class="flex">
<div class="small">
<label>Section</label>
<select id="newSection">
<option value="">-- choisir --</option>
<option value="Maternelle">Maternelle</option>
<option value="Primaire">Primaire</option>
<option value="Collège">Collège</option>
<option value="Lycée">Lycée</option>
</select>
</div>
<div class="small">
<label>Classe</label>
<input id="newClasse" type="text" placeholder="Ex: Seconde, Première, Terminale, 6e">
</div>
</div>

<label>Série (si Lycée)</label>
<input id="newSerie" type="text" placeholder="A, C, D (laisser vide si non applicable)">

<div class="flex">
<div class="small">
<label>Login</label>
<input id="newLogin" type="text" placeholder="login parent/élève">
</div>
<div class="small">
<label>Mot de passe</label>
<input id="newMdp" type="text" placeholder="mot de passe">
</div>
</div>

<label>Photo (URL)</label>
<input id="newPhoto" type="text" placeholder="url image (optionnel)">

<label>Matières / Notes</label>
<div id="matieresContainer" class="muted">Choisir d'abord section (et série si Lycée) → les champs apparaîtront ici.</div>

<div class="flex" style="margin-top:12px">
<button id="btnAdd">Ajouter l'élève</button>
<button id="btnHideAdmin" class="secondary">Fermer admin</button>
</div>

<h3 style="margin-top:18px">Liste des élèves</h3>
<div id="listeContainer">
<table id="tableEleves">
<thead><tr><th>Nom</th><th>Classe</th><th>Login</th><th>Action</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
const ADMIN_CODE = "Admin2025";

const matieresParSection = {
"Maternelle":["Chant","Jeux","Lecture","Dessin"],
"Primaire":["Lecture","Écriture","Calcul","Sciences","Morale"],
"Collège":["Mathématiques","Français","Anglais","SVT","Histoire-Géo"],
"Lycée_A":["Français","Anglais","Histoire-Géo","Espagnol","Mathématiques","Philosophie","Sport"],
"Lycée_C":["Mathématiques","Français","Histoire-Géo","Anglais","SVT","Physique-Chimie"],
"Lycée_D":["Mathématiques","SVT","Physique-Chimie","Français","Anglais"]
};

function getMatieres(section, serie){
if(!section) return [];
if(section==="Lycée"){
const s=(serie||"").toUpperCase();
return matieresParSection["Lycée_"+s]||[];
}
return matieresParSection[section]||[];
}

let eleves = JSON.parse(localStorage.getItem("eleves_v3"))||[];

function save(){ localStorage.setItem("eleves_v3",JSON.stringify(eleves)); }

const loginInput = document.getElementById("login");
const mdpInput = document.getElementById("mdp");
const btnConnect = document.getElementById("btnConnect");
const btnAdmin = document.getElementById("btnAdmin");
const resultPanel = document.getElementById("resultPanel");
const eleveTitre = document.getElementById("eleveTitre");
const elevePhoto = document.getElementById("elevePhoto");
const eleveClasseSpan = document.getElementById("eleveClasse");
const notesContainer = document.getElementById("notesContainer");
const moyenneSpan = document.getElementById("moyenne");
const btnWhats = document.getElementById("btnWhats");
const btnLogout = document.getElementById("btnLogout");

const adminCard = document.getElementById("adminCard");
const newSection = document.getElementById("newSection");
const newClasse = document.getElementById("newClasse");
const newSerie = document.getElementById("newSerie");
const newNom = document.getElementById("newNom");
const newLogin = document.getElementById("newLogin");
const newMdp = document.getElementById("newMdp");
const newPhoto = document.getElementById("newPhoto");
const matieresContainer = document.getElementById("matieresContainer");
const btnAdd = document.getElementById("btnAdd");
const btnHideAdmin = document.getElementById("btnHideAdmin");
const tableBody = document.querySelector("#tableEleves tbody");

// Générer champs matières dynamiques dans admin
function afficherMatieresForm(){
  const section=newSection.value;
  const serie=newSerie.value;
  const matieres=getMatieres(section,serie);
  matieresContainer.innerHTML="";
  if(matieres.length===0){
    matieresContainer.innerHTML="<div class='muted'>Aucune matière automatique.</div>";
    return;
  }
  matieres.forEach(m=>{
    const id="note_"+m.replace(/\s+/g,"_");
    const label=document.createElement("label"); label.textContent=m;
    const input=document.createElement("input"); input.type="number"; input.min=0; input.max=20; input.placeholder="Note sur 20"; input.id=id;
    matieresContainer.appendChild(label); matieresContainer.appendChild(input);
  });
}

newSection.addEventListener("change",afficherMatieresForm);
newSerie.addEventListener("input",afficherMatieresForm);

// Ajouter élève
btnAdd.addEventListener("click",function(){
  const nom=newNom.value.trim(),section=newSection.value,classe=newClasse.value.trim(),
        serie=newSerie.value.trim(),login=newLogin.value.trim(),mdp=newMdp.value.trim(),
        photo=newPhoto.value.trim();
  if(!nom||!section||!classe||!login||!mdp) return alert("Remplis les champs obligatoires.");
  const matieres=getMatieres(section,serie);
  const notes={};
  matieres.forEach(m=>{
    const val=parseFloat(document.getElementById("note_"+m.replace(/\s+/g,"_")).value);
    notes[m]=isNaN(val)?0:val;
  });
  eleves.push({nom,section,classe,serie,login,mdp,photo:photo||"https://via.placeholder.com/120",notes});
  save();
  alert("Élève ajouté avec succès !");
  afficherTableEleves();
  // Reset
  newNom.value=""; newClasse.value=""; newSerie.value=""; newLogin.value=""; newMdp.value=""; newPhoto.value="";
  matieresContainer.innerHTML="Choisir d'abord section (et série si Lycée) → les champs apparaîtront ici.";
});

// Afficher liste élèves dans admin
function afficherTableEleves(){
  tableBody.innerHTML="";
  eleves.forEach(e=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${e.nom}</td><td>${e.classe}</td><td>${e.login}</td>
    <td><button onclick="supprimerEleve('${e.login}')">Supprimer</button></td>`;
    tableBody.appendChild(row);
  });
}

window.supprimerEleve=function(login){
  eleves=eleves.filter(e=>e.login!==login);
  save(); afficherTableEleves();
}

// Connexion parent/élève
btnConnect.addEventListener("click",function(){
  const login=loginInput.value.trim(),mdp=mdpInput.value.trim();
  const eleve=eleves.find(e=>e.login===login && e.mdp===mdp);
  if(!eleve){return alert("Identifiants incorrects.");}
  eleveTitre.textContent="Résultats de : "+eleve.nom;
  eleveClasseSpan.textContent=eleve.classe;
  elevePhoto.src=eleve.photo||"https://via.placeholder.com/120";
  notesContainer.innerHTML="";
  let total=0, count=0;
  Object.entries(eleve.notes).forEach(([mati,val])=>{
    const p=document.createElement("p"); p.className="note"; p.textContent=`${mati} : ${val}`;
    notesContainer.appendChild(p);
    total+=val; count++;
  });
  moyenneSpan.textContent=count>0?(total/count).toFixed(2):"-";
  resultPanel.classList.remove("hidden");
});

// WhatsApp
btnWhats.addEventListener("click",function(){
  const nom=eleveTitre.textContent;
  const classe=eleveClasseSpan.textContent;
  let message=`${nom}\nClasse : ${classe}\n`;
  Array.from(notesContainer.children).forEach(p=>{message+=p.textContent+"\n";});
  const numero="242061617231";
  window.open(`https://wa.me/${numero}?text=${encodeURIComponent(message)}`,"_blank");
});

// Déconnexion
btnLogout.addEventListener("click",()=>resultPanel.classList.add("hidden"));

// Admin
btnAdmin.addEventListener("click",()=>{
  const code=prompt("Entrez le code admin :");
  if(code===ADMIN_CODE){
    adminCard.classList.remove("hidden"); afficherTableEleves();
  } else {alert("Code incorrect.");}
});
btnHideAdmin.addEventListener("click",()=>adminCard.classList.add("hidden"));

</script>
</body>
</html>



